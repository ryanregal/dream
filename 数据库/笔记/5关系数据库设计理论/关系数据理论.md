# 关系数据理论


## 基础概念⭐

#### 实体

- 现实世界中客观存在并可以被区别的事物。比如“一个学生”、“一本书”、“一门课”等等。 值得强调的是这里所说的“事物”不仅仅是看得见摸得着的“东西”，它也可以是虚拟的，比如说“老师与学校的关系。 

#### 属性

- 教科书上解释为：“**实体所具有的某一特性**”，由此可见，属性一开始是个逻辑概念，比如说， “性别”是“人”的一个属性。
- 在关系数据库中，属性又是个物理概念，属性可以看作是**表的一列**。 

#### 元组

- **表中的一行**就是一个元组。 

#### 分量

- 元组的某个属性值。在一个关系数据库中，它是一个操作原子，即关系数据库在做任何操作的时候，属性是不可分的。否则就不是关系数据库了。 

#### 码

- 表中可以唯一确定一个元组的某个属性（或者属性组），如果这样的码有不止一个，那么大家都叫候选码，我们从候选码中挑一个出来做老大，它就叫主码。 

#### 全码

- 如果一个码包含了所有的属性，这个码就是全码。 

#### 主属性

- 一个属性只要在任何一个候选码中出现过，这个属性就是主属性。 

#### 非主属性

- 与上面相反，没有在任何候选码中出现过，这个属性就是非主属性。 

#### 外码

- 一个属性（或属性组），它不是码，但是它别的表的码，它就是外码。



## 函数依赖

### 定义

- 设R(U)是一个关系模式,U是R的属性集合,X和Y是U的子集.对于R(U)的任何一个可能的关系r,如果r中不存在两个元组,它们在X上的属性值相同,而在Y上的属性值不同,则称X函数决定Y,或Y函数依赖于X,记作 X→Y。
- X通常称为“决定因素”

### 几点说明
* 函数依赖是语义范畴的概念.它反映了一种语义完整性约束,只能根据语义来确定一个函数依赖.
* 函数依赖是指关系R模式的**所有关系元组均应满足的约束条件**,而不是关系模式中的某个或某些元组满足的约束条件
* 如果，记作 X→Y,并且Y不是X的子集,则称，记作 X→Y是非平凡的函数依赖;如果Y是X的子集,则称，记作 X→Y是平凡的函数依赖;

### 完全函数依赖、部分函数依赖

- 在 R(U)中,如果 X→Y，并且对于 X 的任何一个真子集 X' ,都有 Y**不**依赖于X,则称 Y 对 X 完全函数依赖。 

- 反之为部分函数依赖。 

- (一般，1:1 为完全函数依赖，m:1 为部分函数依赖) 

  

## 候选码的两个性质

#### 定义

* 标识的唯一性: 对于R(U)中的每一元组,K的值确定后,该元组就相应确定了.
* 无冗余性: K是属性组的情况下,K的任何一部分都不能唯一标识该元组(定义中的完全函数依赖的意义) 



## 规范化

### 简介
* 用几个简单的关系去取代原来结构复杂的关系的过程叫做关系规范化.

* 规范化理论是研究如何把一个不好的关系模式转化为好的关系模式的理论

* 规范化理论是E.E.Codd在1971年首先提出的

  
### 范式⭐⭐⭐⭐⭐
#### 特点

* 规范化理论是围绕着范式建立的.

* 满足不同程度要求的约束集则称为不同的范式.

* 如果一个关系满足某个指定的约束集,则称它属于某个特定的范式.

* 较高层次的范式比较低层次的范式具有“更合乎要求的性质”

* 一个低一级范式的关系模式,通过投影运算可以转化为若干个高一级范式的关系模式的集合,这个过程叫做规范化.

* 如果一个关系满足某个范式要求,则它也会满足较其级别低的所有范式的要求

  

#### 第一范式(1NF)

* 定义5: 在关系模式R中的每一个具体关系r中,如果每个属性值都是不可再分的最小数据单位,则称R是第一范式的关系,记作R∈1NF.

* 1NF规范化: 把非规范化关系规范提高到1NF关系模式的集合.

* 属性不可再分

  

#### 第二范式(2NF)

* 定义6: 若关系模式R∈1NF,且每个非主属性都完全依赖于R的任意候选码,则关系模式R属于第二范式,记作R ∈2NF.

* 从1NF中消除非主属性对候选码的部分函数依赖,则获得2NF关系.

* 每一个非主属性完全函数依赖于码（除去不完全的函数依赖）

* e.g：

  * **学生   课程**  老师  老师职称   教材   教室 上课时间

  * （学生，课程）是码，但是非主属性“教材”可以只依赖于“课程”，即非主属性“教材”部分依赖于（学生，课程），不属于第二范式

  * 投影拆分：

    * **学生   教材**  老师  老师职称    教室  上课时间

    * **课程**  教材  

      

#### 第三范式(3NF)

* 定义7: 若关系模式R∈2NF,且每个非主属性都不传递依赖于R的任意候选码,则R∈3NF.

* 从2NF关系中,**消除非主属性对码的传递依赖函数**而获得3NF关系

* R∈3NF,则每个非主属性既不部分依赖,也不传递依赖于R的任何候选码.

* e.g

  * **学生   教材**   老师   老师职称    教室  上课时间
  * **课程**  教材  
  * 其中非主属性“老师职称”传递依赖于候选码（学生，课程），不属于第三范式。
  * 投影拆分：
    * **学生   教材**   老师   教室  上课时间
    * **课程**  教材  
    * **老师**   老师职称

  

#### BCNF范式

* 3NF的不完善性
    
    * 定义8: 若R∈1NF,**且R中每个决定因素都是候选码**,则R ∈BCNF.
    
    * 满足BCNF的关系将消除**任何属性**对候选码的部分依赖与传递依赖
    
    * 应用BCNF定义时,可直接判断1NF是否属于BCNF(传递依赖中左边必有码)
    
    * 若一个关系达到了第三范式，并且它只有一个候选码，或者它的每个候选码都是单属性，则该关 
    
      系自然达到 BC 范式。
    
    * e.g
    
      * 学生    教师    课程
      * 每一教师只教一门课，每门课有若干教师，某一学生选定某门课，就对应一个固定的教师。
      * （学生，课程）→ 教师 , (学生，教师) → 课程
    
      * 由于没有非主属性，是第三范式，但是存在 教师→课程，而教师不是候选码，所以不是BC 范式。
    
      

#### 第四范式

* 要求把同一表内的多对多关系删除



## 消除依赖

![image-20220512163201010](C:\Users\icebear\AppData\Roaming\Typora\typora-user-images\image-20220512163201010.png)



### 1NF→2NF

- 消除主属性对码的部分函数依赖

- 将 STUDENT 中对码完全依赖的属性和部分函数依赖的属性分别组成关系。即将 STUDENT 关系模式分解成三个关系模式： 

  - STUDENT1 （**SNO**，SNAME，AGE，SEX，CLASS，DEPTNO，DEPTNAME）

  - COURSE（**CNO**，CNAME，CREDIT） 

  - SC（**SNO**，CNO，SCORE） 

- 在分解后的每一个关系模式中，***非主属性对码是完全函数依赖***，所以上述三个关系模式均为 2NF。 



### 2NF→3NF

- 消除非主属性对码的传递函数依赖
- 第三范式（3NF）:（1）第一范式  （2）不存在非主属性对码的传递依赖。

- 例子：

  - STUDENT1 （**SNO**，SNAME，AGE，SEX，CLASS，DEPTNO，DEPTNAME）
  - 存在着下列函数依赖：SNO-->CLASS，CLASS-->DEPTNO。存在传递依赖，不是 3NF。 

  - 如果关系模式 R 为 2NF 而不是 3NF。即存在数据冗余，插入和删除会出现异常。
    - 对每一学生，DEPTNO，DEPTNAME 将重复出现。
    - 当新成立一个系后，在尚未有学生时，该系的信息插入不到该关系中 

  - 对模式分解，消除传递依赖。将 STUDENT1 分解为下列模式： 

    - STUDENT2（SNO，SNAME，AGE，SEX，CLASS） 

    - CLASS2（CLASS，DEPTNO） 

    - DEPARTMENT（DEPTNO，DEPTNAME） 



### 3NF→BCNF

- BCNF 范式：BCNF 是修正的第三范式。 
- 设关系模式 R(U，F)∈1NF，若 X→Y，而 Y 不包含在 X 中，那么 X 必含有码，则 R(U, F) 为 BCNF。
- 换句话说，**每个决定因素都包含有码**，则关系模式为 BCNF。 
- 3NF 关系模式和 BCNF 的关系模式之间有下列关系： 
  - 如果 R∈ BCNF，则 R∈3NF，反之不成立。 
- BCNF 的定义消除了 3NF 模式中可能存在**主属性对码的部分函数依赖和传递函数依赖**。